
# Advanced Malware Scanner Using YARA

This project is an advanced malware scanner implemented in Python. It uses the YARA library to detect malicious patterns in files or directories. The program supports scanning individual files or entire directories and logs the results for further analysis.

---

## Features

1. **Automatic Environment Setup**: 
   - Creates a base directory (`./malware_scanner`) to store logs and rules.
   - Automatically generates a sample YARA rule if none exists.

2. **File and Directory Scanning**:
   - Scans a single file or recursively scans all files in a directory.

3. **YARA Integration**:
   - Utilizes YARA rules to detect malware patterns.

4. **Detailed Logging**:
   - Logs events, detections, and errors into a log file (`scanner.log`).

---

## Prerequisites

1. **Python**: Ensure you have Python 3.6 or above installed.
2. **YARA-Python**: Install the `yara-python` library:
   ```bash
   pip install yara-python
   ```

---

## Installation

1. Clone the repository or download the script.
2. Ensure the required Python packages are installed.

---

## Usage

Run the program with the following command:

```bash
python malware_scanner.py <path_to_file_or_directory>
```

### Arguments:
- `<path_to_file_or_directory>`: Path to the file or directory to scan.

---

## Example

### Scan a File
```bash
python malware_scanner.py test_malware.exe
```

### Scan a Directory
```bash
python malware_scanner.py ./test_directory
```

### Output
- Scanning results and logs are stored in `./malware_scanner/scanner.log`.

---

## File Structure

- **`malware_scanner/`**: Base directory for logs and rules.
  - **`rules/`**: Contains YARA rule files.
  - **`scanner.log`**: Log file with scanning details.

---

## How to Test

You can create a dummy `.exe` file with the following script:

```python
# Save this as create_test_exe.py and run it
import os

def create_dummy_exe(file_path="test_malware.exe"):
    pe_header = b"MZ" + b"\x00" * 58 + b"\x40\x00\x00\x00"
    malicious_code = b"malicious_code"  # Matches YARA rule
    padding = b"\x90" * 100

    with open(file_path, "wb") as f:
        f.write(pe_header + malicious_code + padding)
    print(f"Dummy executable created at: {file_path}")

if __name__ == "__main__":
    create_dummy_exe()
```

Run the test script and then scan the generated `test_malware.exe` file:
```bash
python malware_scanner.py test_malware.exe
```

---

## Logs

The results of the scan are stored in the log file:
- Location: `./malware_scanner/scanner.log`
- Example log entry:
  ```
  2024-11-19 12:00:00 - WARNING - Malware detected in test_malware.exe: [DummyRule]
  ```

---

## Troubleshooting

- **Error: `No YARA rule files found in the rules directory.`**
  - Ensure the rules directory (`./malware_scanner/rules`) contains `.yar` files.
  - The program automatically generates a sample rule if none exists.

- **Invalid Path**:
  - Ensure the file or directory path provided exists and is accessible.

---
